<!DOCTYPE html>
<html>
  <head>
    <style>
      html,
      body {
        font-family: Arial, sans-serif;
        height: 100%;
        margin: 0;
        padding: 0;
      }
      #map {
        height: 100%;
      }

      #pano {
        width: 200px;
        height: 200px;
      }

      #wiki {
        width: 200px;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var map;

      var locations = [
        {title: 'Golden Gate Bridge', location: {lat: 37.8199 , lng: -122.4783}},
        {title: 'Golden Gate Park', location: {lat: 37.7694, lng: -122.4862}},
        {title: 'Lands End', location: {lat: 37.7797, lng: -122.5116}},
        {title: 'Legion Of Honor', location: {lat: 37.7845, lng: -122.5008}},
        {title: 'Palace of Fine Arts', location: {lat: 37.8021, lng: -122.4488}},
        {title: 'Japantown', location: {lat: 37.7854, lng: -122.4294}},
        {title: 'Ferry Building', location: {lat: 37.7956, lng: -122.3933}},
        {title: 'Fisherman\'s Wharf', location: {lat: 37.8080, lng: -122.4177}},
        {title: 'AT&T Park', location: {lat: 37.7786, lng: -122.3893}},
        {title: 'Castro Theater', location: {lat: 37.7621, lng: -122.4350}}
      ];

      var markers = [];

      //Create New Map
      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 37.7817, lng: -122.4498},
          zoom: 13,
          disableDefaultUI: true
        });

        var defaultIcon = makeMarkerIcon('ff3321');
        var highlightedIcon = makeMarkerIcon('22e018');

        var largeInfowindow = new google.maps.InfoWindow();

        for (var i = 0; i < locations.length; i++) {

          var position = locations[i].location;
          var title = locations[i].title;

          var marker = new google.maps.Marker({
            position: position,
            map: map,
            title: title,
            animation: google.maps.Animation.DROP,
            icon: defaultIcon,
            id: i
          });
          markers.push(marker);
          marker.addListener('click', function() {
            populateInfoWindow(this, largeInfowindow);
          });
          marker.addListener('mouseover', function() {
            this.setIcon(highlightedIcon);
          });
          marker.addListener('mouseout', function() {
            this.setIcon(defaultIcon);
          });
        }
      }

      //Make Info Window
      function populateInfoWindow(marker, infowindow) {
        if (infowindow.marker != marker) {
          infowindow.setContent('');
          infowindow.marker = marker;
          infowindow.setContent('<h1>' + marker.title + '</h1><div id="pano"></div><p id="wiki"></p>');
          infowindow.addListener('closeclick', function() {
            infowindow.marker = null;
          });
          var streetViewService = new google.maps.StreetViewService();
          var radius = 50;

          function getStreetView(data, status) {
            if (status == google.maps.StreetViewStatus.OK) {
              var nearStreetViewLocation = data.location.latLng;
              var heading = google.maps.geometry.spherical.computeHeading(
                      nearStreetViewLocation, marker.position);
              var panoramaOptions = {
                position: nearStreetViewLocation,
                pov: {
                  heading: heading,
                  pitch: 30
                },
                panControl: false,
                zoomControl: false,
                addressControl: false,
                fullscreenControl: false,
                motionTrackingControl: false,
                linksControl: false
              };
              var panorama = new google.maps.StreetViewPanorama(
                document.getElementById('pano'), panoramaOptions);
            } else {
              $("#pano").text("No Street View Found");
            }
          }

          function getWikipidia() {
            var wikiUrl = "https://en.wikipedia.org/w/api.php?action=opensearch&search=" + marker.title + "&limit=1&namespace=0&format=json";

            var wikiRequestTimeout = setTimeout( function () {
              $('#wiki').text("Could not find Wikipedia Data");
            }, 1000);

            $.ajax({
              url: wikiUrl,
              dataType: 'jsonp',
              success: function (responce) {
                var para = responce[2][0];
                $('#wiki').text(para);
                $('#wiki').after('<p>From Wikipedia</p>');
                clearTimeout(wikiRequestTimeout);
              }
            });
          }

          streetViewService.getPanoramaByLocation(marker.position, radius, getStreetView);
          getWikipidia();
          infowindow.open(map, marker);
        }
      }

      function makeMarkerIcon(markerColor) {
        var markerImage = new google.maps.MarkerImage(
          'http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|'+ markerColor + '|40|_|%E2%80%A2',
          new google.maps.Size(21, 34),
          new google.maps.Point(0, 0),
          new google.maps.Point(10, 34),
          new google.maps.Size(21,34));
        return markerImage;
      }
    </script>

    <script async defer 
        src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"/>
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC58npQfbraWbdf4Zy9kIiq36S2zP7goKY&v=3&callback=initMap">
    </script>

  </body>
</html>